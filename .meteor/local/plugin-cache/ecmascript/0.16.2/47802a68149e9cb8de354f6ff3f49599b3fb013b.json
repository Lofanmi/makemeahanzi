{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/a37/code/github/makemeahanzi-tool/packages/lai:collection-extensions/collection-extensions.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","objectRestSpread","asyncGenerators","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"os.osx.arm64"},"sourceFileName":"packages/lai:collection-extensions/collection-extensions.js","filename":"/Users/a37/code/github/makemeahanzi-tool/packages/lai:collection-extensions/collection-extensions.js","targets":{},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/a37/code/github/makemeahanzi-tool","root":"/Users/a37/code/github/makemeahanzi-tool","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-meteor-async-await","visitor":{"AwaitExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]},"ClassPrivateMethod":{"exit":[null]}},"options":{"useNativeAsyncAwait":false},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/a37/code/github/makemeahanzi-tool/packages/lai:collection-extensions/collection-extensions.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"packages/lai:collection-extensions/collection-extensions.js"}},"code":"let Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor(v) {\n    Meteor = v;\n  }\n\n}, 0);\nlet Mongo;\nmodule.link(\"meteor/mongo\", {\n  Mongo(v) {\n    Mongo = v;\n  }\n\n}, 1);\n// The collection extensions namespace\nCollectionExtensions = {}; // eslint-disable-line no-global-assign\n// Stores all the collection extensions\n\nCollectionExtensions._extensions = []; // This is where you would add custom functionality to\n// Mongo.Collection/Meteor.Collection\n\nCollectionExtensions.addExtension = function (customFunction) {\n  if (typeof customFunction !== 'function') {\n    throw new Meteor.Error('collection-extension-wrong-argument', 'You must pass a function into CollectionExtensions.addExtension().');\n  }\n\n  CollectionExtensions._extensions.push(customFunction); // If Meteor.users exists, apply the extension right away\n\n\n  if (typeof Meteor.users !== 'undefined') {\n    customFunction.apply(Meteor.users, ['users']);\n  }\n}; // Backwards compatibility\n\n\nMeteor.addCollectionExtension = function () {\n  console.warn('`Meteor.addCollectionExtension` is deprecated, please use `CollectionExtensions.addExtension`');\n  CollectionExtensions.addExtension.apply(null, arguments);\n}; // Utility function to add a prototype function to your\n// Meteor/Mongo.Collection object\n\n\nCollectionExtensions.addPrototype = function (name, customFunction) {\n  if (typeof name !== 'string') {\n    throw new Meteor.Error('collection-extension-wrong-argument', 'You must pass a string as the first argument into CollectionExtensions.addPrototype().');\n  }\n\n  if (typeof customFunction !== 'function') {\n    throw new Meteor.Error('collection-extension-wrong-argument', 'You must pass a function as the second argument into CollectionExtensions.addPrototype().');\n  }\n\n  (typeof Mongo !== 'undefined' ? Mongo.Collection : Meteor.Collection).prototype[name] = customFunction;\n}; // Backwards compatibility\n\n\nMeteor.addCollectionPrototype = function () {\n  console.warn('`Meteor.addCollectionPrototype` is deprecated, please use `CollectionExtensions.addPrototype`');\n  CollectionExtensions.addPrototype.apply(null, arguments);\n}; // This is used to reassign the prototype of unfortunately\n// and unstoppably already instantiated Mongo instances\n// i.e. Meteor.users\n\n\nfunction reassignCollectionPrototype(instance, constr) {\n  const hasSetPrototypeOf = typeof Object.setPrototypeOf === 'function';\n  if (!constr) constr = typeof Mongo !== 'undefined' ? Mongo.Collection : Meteor.Collection; // __proto__ is not available in < IE11\n  // Note: Assigning a prototype dynamically has performance implications\n\n  if (hasSetPrototypeOf) {\n    Object.setPrototypeOf(instance, constr.prototype);\n  } else if (instance.__proto__) {\n    // eslint-disable-line no-proto\n    // eslint-disable-next-line no-proto\n    instance.__proto__ = constr.prototype;\n  }\n} // This monkey-patches the Collection constructor\n// This code is the same monkey-patching code\n// that matb33:collection-hooks uses, which works pretty nicely\n\n\nfunction wrapCollection(ns, as) {\n  // Save the original prototype\n  if (!as._CollectionPrototype) as._CollectionPrototype = new as.Collection(null);\n  const constructor = as.Collection;\n  const proto = as._CollectionPrototype;\n\n  ns.Collection = function () {\n    const ret = constructor.apply(this, arguments); // This is where all the collection extensions get processed\n\n    processCollectionExtensions(this, arguments);\n    return ret;\n  };\n\n  ns.Collection.prototype = proto;\n  ns.Collection.prototype.constructor = ns.Collection;\n\n  for (const prop in constructor) {\n    if (Object.prototype.hasOwnProperty.call(constructor, prop)) {\n      ns.Collection[prop] = constructor[prop];\n    }\n  }\n}\n\nfunction processCollectionExtensions(self, args) {\n  // Using old-school operations for better performance\n  // Please don't judge me ;P\n  const applyArgs = args ? [].slice.call(args, 0) : undefined;\n  const extensions = CollectionExtensions._extensions;\n\n  for (let i = 0, len = extensions.length; i < len; i++) {\n    extensions[i].apply(self, applyArgs);\n  }\n}\n\nif (typeof Mongo !== 'undefined') {\n  wrapCollection(Meteor, Mongo);\n  wrapCollection(Mongo, Mongo);\n} else {\n  wrapCollection(Meteor, Meteor);\n}\n\nif (typeof Meteor.users !== 'undefined') {\n  // Ensures that Meteor.users instanceof Mongo.Collection\n  reassignCollectionPrototype(Meteor.users);\n}","map":{"version":3,"sources":["packages/lai:collection-extensions/collection-extensions.js"],"names":["Meteor","module","link","v","Mongo","CollectionExtensions","_extensions","addExtension","customFunction","Error","push","users","apply","addCollectionExtension","console","warn","arguments","addPrototype","name","Collection","prototype","addCollectionPrototype","reassignCollectionPrototype","instance","constr","hasSetPrototypeOf","Object","setPrototypeOf","__proto__","wrapCollection","ns","as","_CollectionPrototype","constructor","proto","ret","processCollectionExtensions","prop","hasOwnProperty","call","self","args","applyArgs","slice","undefined","extensions","i","len","length"],"mappings":"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","sourcesContent":["/* global CollectionExtensions */\nimport { Meteor } from 'meteor/meteor'\nimport { Mongo } from 'meteor/mongo'\n\n// The collection extensions namespace\nCollectionExtensions = {} // eslint-disable-line no-global-assign\n\n// Stores all the collection extensions\nCollectionExtensions._extensions = []\n\n// This is where you would add custom functionality to\n// Mongo.Collection/Meteor.Collection\nCollectionExtensions.addExtension = function (customFunction) {\n  if (typeof customFunction !== 'function') {\n    throw new Meteor.Error(\n      'collection-extension-wrong-argument',\n      'You must pass a function into CollectionExtensions.addExtension().')\n  }\n  CollectionExtensions._extensions.push(customFunction)\n  // If Meteor.users exists, apply the extension right away\n  if (typeof Meteor.users !== 'undefined') {\n    customFunction.apply(Meteor.users, ['users'])\n  }\n}\n\n// Backwards compatibility\nMeteor.addCollectionExtension = function () {\n  console.warn('`Meteor.addCollectionExtension` is deprecated, please use `CollectionExtensions.addExtension`')\n  CollectionExtensions.addExtension.apply(null, arguments)\n}\n\n// Utility function to add a prototype function to your\n// Meteor/Mongo.Collection object\nCollectionExtensions.addPrototype = function (name, customFunction) {\n  if (typeof name !== 'string') {\n    throw new Meteor.Error(\n      'collection-extension-wrong-argument',\n      'You must pass a string as the first argument into CollectionExtensions.addPrototype().')\n  }\n  if (typeof customFunction !== 'function') {\n    throw new Meteor.Error(\n      'collection-extension-wrong-argument',\n      'You must pass a function as the second argument into CollectionExtensions.addPrototype().')\n  }\n  (typeof Mongo !== 'undefined'\n    ? Mongo.Collection\n    : Meteor.Collection).prototype[name] = customFunction\n}\n\n// Backwards compatibility\nMeteor.addCollectionPrototype = function () {\n  console.warn('`Meteor.addCollectionPrototype` is deprecated, please use `CollectionExtensions.addPrototype`')\n  CollectionExtensions.addPrototype.apply(null, arguments)\n}\n\n// This is used to reassign the prototype of unfortunately\n// and unstoppably already instantiated Mongo instances\n// i.e. Meteor.users\nfunction reassignCollectionPrototype (instance, constr) {\n  const hasSetPrototypeOf = typeof Object.setPrototypeOf === 'function'\n\n  if (!constr) constr = typeof Mongo !== 'undefined' ? Mongo.Collection : Meteor.Collection\n\n  // __proto__ is not available in < IE11\n  // Note: Assigning a prototype dynamically has performance implications\n  if (hasSetPrototypeOf) {\n    Object.setPrototypeOf(instance, constr.prototype)\n  } else if (instance.__proto__) { // eslint-disable-line no-proto\n  // eslint-disable-next-line no-proto\n    instance.__proto__ = constr.prototype\n  }\n}\n\n// This monkey-patches the Collection constructor\n// This code is the same monkey-patching code\n// that matb33:collection-hooks uses, which works pretty nicely\nfunction wrapCollection (ns, as) {\n  // Save the original prototype\n  if (!as._CollectionPrototype) as._CollectionPrototype = new as.Collection(null)\n\n  const constructor = as.Collection\n  const proto = as._CollectionPrototype\n\n  ns.Collection = function () {\n    const ret = constructor.apply(this, arguments)\n    // This is where all the collection extensions get processed\n    processCollectionExtensions(this, arguments)\n    return ret\n  }\n\n  ns.Collection.prototype = proto\n  ns.Collection.prototype.constructor = ns.Collection\n\n  for (const prop in constructor) {\n    if (Object.prototype.hasOwnProperty.call(constructor, prop)) {\n      ns.Collection[prop] = constructor[prop]\n    }\n  }\n}\n\nfunction processCollectionExtensions (self, args) {\n  // Using old-school operations for better performance\n  // Please don't judge me ;P\n  const applyArgs = args ? [].slice.call(args, 0) : undefined\n  const extensions = CollectionExtensions._extensions\n  for (let i = 0, len = extensions.length; i < len; i++) {\n    extensions[i].apply(self, applyArgs)\n  }\n}\n\nif (typeof Mongo !== 'undefined') {\n  wrapCollection(Meteor, Mongo)\n  wrapCollection(Mongo, Mongo)\n} else {\n  wrapCollection(Meteor, Meteor)\n}\n\nif (typeof Meteor.users !== 'undefined') {\n  // Ensures that Meteor.users instanceof Mongo.Collection\n  reassignCollectionPrototype(Meteor.users)\n}\n"]},"sourceType":"module","externalDependencies":{},"hash":"47802a68149e9cb8de354f6ff3f49599b3fb013b"}
